if(typeof JSON2!=='object'){JSON2={}}(function(){'use strict';function f(n){return n<10?'0'+n:n}function objectToJSON(value,key){var objectType=Object.prototype.toString.apply(value);if(objectType==='[object Date]'){return isFinite(value.valueOf())?value.getUTCFullYear()+'-'+f(value.getUTCMonth()+1)+'-'+f(value.getUTCDate())+'T'+f(value.getUTCHours())+':'+f(value.getUTCMinutes())+':'+f(value.getUTCSeconds())+'Z':null}if(objectType==='[object String]'||objectType==='[object Number]'||objectType==='[object Boolean]'){return value.valueOf()}if(objectType!=='[object Array]'&&typeof value.toJSON==='function'){return value.toJSON(key)}return value}var cx=new RegExp('[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]','g'),pattern='\\\\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]',escapable=new RegExp('['+pattern,'g'),gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'){value=objectToJSON(value,key)}if(typeof rep==='function'){value=rep.call(holder,key,value)}switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null'}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null'}v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v}if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v)}}}}v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v}}if(typeof JSON2.stringify!=='function'){JSON2.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' '}}else if(typeof space==='string'){indent=space}rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON2.stringify');}return str('',{'':value})}}if(typeof JSON2.parse!=='function'){JSON2.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4)})}if((new RegExp('^[\\],:{}\\s]*$')).test(text.replace(new RegExp('\\\\(?:["\\\\/bfnrt]|u[0-9a-fA-F]{4})','g'),'@').replace(new RegExp('"[^"\\\\\n\r]*"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?','g'),']').replace(new RegExp('(?:^|:|,)(?:\\s*\\[)+','g'),''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j}throw new SyntaxError('JSON2.parse');}}}());if(typeof _rlq!=='object'){_rlq=[]}var strack=strack||(function(window,document){'use strict';var module={};var data={};var version='2017-04-07';var name='Bmine Tracker';var trackerUrl=(('https:'==document.location.protocol)?'https':'http')+'://be.show/plugins/strack/strack.php';var expireDateTime,timeNextTrackingRequestCanBeExecutedImmediately=false,configTrackerPause=500,configDiscardHashTag=false;var self=module;var urldecode=unescape;function sha1(str){var rotate_left=function(n,s){return(n<<s)|(n>>>(32-s))},cvt_hex=function(val){var strout='',i,v;for(i=7;i>=0;i--){v=(val>>>(i*4))&0x0f;strout+=v.toString(16)}return strout},blockstart,i,j,W=[],H0=0x67452301,H1=0xEFCDAB89,H2=0x98BADCFE,H3=0x10325476,H4=0xC3D2E1F0,A,B,C,D,E,temp,str_len,word_array=[];str=encodeUTF8(str);str_len=str.length;for(i=0;i<str_len-3;i+=4){j=str.charCodeAt(i)<<24|str.charCodeAt(i+1)<<16|str.charCodeAt(i+2)<<8|str.charCodeAt(i+3);word_array.push(j)}switch(str_len&3){case 0:i=0x080000000;break;case 1:i=str.charCodeAt(str_len-1)<<24|0x0800000;break;case 2:i=str.charCodeAt(str_len-2)<<24|str.charCodeAt(str_len-1)<<16|0x08000;break;case 3:i=str.charCodeAt(str_len-3)<<24|str.charCodeAt(str_len-2)<<16|str.charCodeAt(str_len-1)<<8|0x80;break}word_array.push(i);while((word_array.length&15)!==14){word_array.push(0)}word_array.push(str_len>>>29);word_array.push((str_len<<3)&0x0ffffffff);for(blockstart=0;blockstart<word_array.length;blockstart+=16){for(i=0;i<16;i++){W[i]=word_array[blockstart+i]}for(i=16;i<=79;i++){W[i]=rotate_left(W[i-3]^W[i-8]^W[i-14]^W[i-16],1)}A=H0;B=H1;C=H2;D=H3;E=H4;for(i=0;i<=19;i++){temp=(rotate_left(A,5)+((B&C)|(~B&D))+E+W[i]+0x5A827999)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}for(i=20;i<=39;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+0x6ED9EBA1)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}for(i=40;i<=59;i++){temp=(rotate_left(A,5)+((B&C)|(B&D)|(C&D))+E+W[i]+0x8F1BBCDC)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}for(i=60;i<=79;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+0xCA62C1D6)&0x0ffffffff;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}H0=(H0+A)&0x0ffffffff;H1=(H1+B)&0x0ffffffff;H2=(H2+C)&0x0ffffffff;H3=(H3+D)&0x0ffffffff;H4=(H4+E)&0x0ffffffff}temp=cvt_hex(H0)+cvt_hex(H1)+cvt_hex(H2)+cvt_hex(H3)+cvt_hex(H4);return temp.toLowerCase()}function isDefined(property){var propertyType=typeof property;return propertyType!=='undefined'}function isFunction(property){return typeof property==='function'}function isObject(property){return typeof property==='object'}function isString(property){return typeof property==='string'||property instanceof String}function apply(){var i,name,parameterArray,methodName,targetMethod;for(i=0;i<arguments.length;i+=1){parameterArray=arguments[i];name=parameterArray.shift();methodName=String(name);targetMethod=self.basicMethod[methodName];if(typeof targetMethod==="function"){targetMethod.apply(self,parameterArray)}}}function addEventListener(element,eventType,eventHandler,useCapture){if(element.addEventListener){element.addEventListener(eventType,eventHandler,useCapture);return true}if(element.attachEvent){return element.attachEvent('on'+eventType,eventHandler)}element['on'+eventType]=eventHandler}function beforeUnloadHandler(){var now;if(expireDateTime){do{now=new Date()}while(now.getTime()<expireDateTime)}}function encodeUTF8(argString){return urldecode(encodeURIComponent(argString))}function getParameter(url,name){var regexSearch="[\\?&#]"+name+"=([^&#]*)";var regex=new RegExp(regexSearch);var results=regex.exec(url);return results?decodeURIComponent(results[1]):''}function getReferrer(){var referrer='';try{referrer=window.top.document.referrer}catch(e){if(window.parent){try{referrer=window.parent.document.referrer}catch(e2){referrer=''}}}if(referrer===''){referrer=document.referrer}return referrer}function purify(url){var targetPattern;if(configDiscardHashTag){targetPattern=new RegExp('#.*');return url.replace(targetPattern,'')}return url}function setExpireDateTime(delay){var now=new Date();var time=now.getTime()+delay;if(!expireDateTime||time>expireDateTime){expireDateTime=time}}function makeSureThereIsAGapAfterFirstTrackingRequestToPreventMultipleVisitorCreation(callback){var now=new Date();var timeNow=now.getTime();if(timeNextTrackingRequestCanBeExecutedImmediately&&timeNow<timeNextTrackingRequestCanBeExecutedImmediately){var timeToWait=timeNextTrackingRequestCanBeExecutedImmediately-timeNow;setTimeout(callback,timeToWait);setExpireDateTime(timeToWait+50);timeNextTrackingRequestCanBeExecutedImmediately+=50;return}if(timeNextTrackingRequestCanBeExecutedImmediately===false){var delayInMs=800;timeNextTrackingRequestCanBeExecutedImmediately=timeNow+delayInMs}callback()}function getCookie(cookieName){var cookiePattern=new RegExp('(^|;)[ ]*'+cookieName+'=([^;]*)'),cookieMatch=cookiePattern.exec(document.cookie);return cookieMatch?decodeURIComponent(cookieMatch[2]):''}function setCookie(cookieName,value,msToExpire,domain,path){var expiryDate;if(msToExpire!=''){expiryDate=new Date();expiryDate.setTime(expiryDate.getTime()+msToExpire)}document.cookie=cookieName+'='+encodeURIComponent(value)+(msToExpire?';expires='+expiryDate.toGMTString():'')+(domain?';domain='+domain:'')+';path='+(path||'/')}function trim(text){if(text&&String(text)===text){return text.replace(/^\s+|\s+$/g,'')}return text}function loadScript(url,callback){var script=document.createElement('script');script.type='text/javascript';if(script.readyState){script.onreadystatechange=function(){if(script.readyState=='loaded'||script.readyState=='complete'){script.onreadystatechange=null;if(typeof callback==='function'){callback()}}}}else{script.onload=function(){if(typeof callback==='function'){callback()}}}script.src=url;var head=document.getElementsByTagName('head')[0]||document.documentElement;head.insertBefore(script,head.firstChild)}function getImage(request,callback){var image=new Image(1,1);image.onload=function(){if(typeof callback==='function'){callback()}};image.src=trackerUrl+(trackerUrl.indexOf('?')<0?'?':'&')+request}function sendXmlHttpRequest(request,callback,fallbackToGet){if(typeof fallbackToGet==='undefined'||fallbackToGet===null){fallbackToGet=true}try{var xhr=window.XMLHttpRequest?new window.XMLHttpRequest():window.ActiveXObject?new ActiveXObject('Microsoft.XMLHTTP'):null;xhr.open('POST',trackerUrl,true);xhr.onreadystatechange=function(){if(this.readyState===4&&!(this.status>=200&&this.status<300)&&fallbackToGet){getImage(request,callback)}else if(this.readyState===4&&this.status==200&&fallbackToGet){}else{if(typeof callback==='function'){callback()}}};var requestContentType='application/x-www-form-urlencoded; charset=UTF-8';xhr.setRequestHeader('Content-Type',requestContentType);xhr.send(request)}catch(e){if(fallbackToGet){getImage(request,callback)}}}function sendRequest(request,delay,callback){if(request){makeSureThereIsAGapAfterFirstTrackingRequestToPreventMultipleVisitorCreation(function(){getImage(request,callback);setExpireDateTime(delay)})}}function getStrValue(value,defaultValue){return(typeof value==='undefined'||value===null)?defaultValue:String(value)}function setStore(value){data.store=getStrValue(value,'')}function setDomain(value){data.domain=getStrValue(value,'')}function setDevice(value){data.device=getStrValue(value,'')}function setUserId(value){data.userId=getStrValue(value,'')}function setUserGroup(value){data.userGroup=getStrValue(value,'')}function setOrderId(value){data.orderId=getStrValue(value,'')}function setOrderPrice(value){data.orderPrice=getStrValue(value,'');data.orderPrice=data.orderPrice.replace(/[^0-9.]/g,'')}function setOrderPhoneNumber(value){data.orderPhoneNumber=getStrValue(value,'')}function setOrderItemNumber(value){data.orderItemNumber=data.orderItemNumber||[];if(value){data.orderItemNumber.push(value)}}function setOrderItemLink(value){data.orderItemLink=data.orderItemLink||[];if(value){data.orderItemLink.push(value)}}function setOrderItemImage(value){data.orderItemImage=data.orderItemImage||[];if(value){data.orderItemImage.push(value)}}function setOrderItemName(value){data.orderItemName=data.orderItemName||[];if(value){data.orderItemName.push(value)}}function setOrderItemPrice(value){data.orderItemPrice=data.orderItemPrice||[];if(value){data.orderItemPrice.push(String(value).replace(/[^0-9.]/g,''))}}function setOrderItemQuantity(value){data.orderItemQuantity=data.orderItemQuantity||[];if(value){data.orderItemQuantity.push(String(value).replace(/[^0-9.]/g,''))}}function execute(name,value){var methodName=String(name);var targetMethod=self.basicMethod[methodName];if(typeof targetMethod==="function"){targetMethod.call(self,value)}}function getPCID(){if(!getCookie('UPCID')){var randomNumber=Math.floor(10000+Math.random()*90000);var cookieValue=(new Date()).getTime()+String(randomNumber);var expire=365*24*60*60*1000;setCookie('UPCID',cookieValue,expire,'.'+data.domain)}return getCookie('UPCID')}function getReco(){var strDomain=data.domain;var nowMediaReferrer='';var nowItemCode=getParameter(window.location.search,'_strackcode');var nowReferSoln=getParameter(window.location.search,'_stracksoln');var duration=3;if(strDomain.indexOf('lfmall')>-1){nowMediaReferrer=getParameter(window.location.search,'strack');duration=15}else{nowMediaReferrer=getParameter(window.location.search,'_strack')}if(nowMediaReferrer!=''){setCookie('BS_MID','',-1,'.'+data.domain);setCookie('BS_MID',nowMediaReferrer,duration*24*60*60*1000,'.'+data.domain)}if(nowItemCode!=''){var oldReco=getCookie('STRACKRECO_'+nowItemCode);if(oldReco!=''){setCookie('STRACKRECO_'+nowItemCode,'',-1,'.'+data.domain)}var StrackRecoInfoArray={c:nowItemCode,s:nowReferSoln,d:Math.floor(new Date().getTime()/1000)};setCookie('STRACKRECO_'+nowItemCode,JSON2.stringify(StrackRecoInfoArray),duration*24*60*60*1000,'.'+data.domain)}return''}function getCommonRequest(){var request='store='+encodeURIComponent(data.store);return request}function getOrderRequest(request){request+='&action=order'+'&uid='+encodeURIComponent(data.userId)+'&oid='+encodeURIComponent(data.orderId)+'&dv='+encodeURIComponent(data.device)+'&price='+encodeURIComponent(data.orderPrice)+'&phonenumber='+encodeURIComponent(data.orderPhoneNumber)+'&itemnumber='+encodeURIComponent(JSON2.stringify(data.orderItemNumber))+'&itemlink='+encodeURIComponent(JSON2.stringify(data.orderItemLink))+'&itemimage='+encodeURIComponent(JSON2.stringify(data.orderItemImage))+'&itemname='+encodeURIComponent(JSON2.stringify(data.orderItemName))+'&itemprice='+encodeURIComponent(JSON2.stringify(data.orderItemPrice))+'&itemquantity='+encodeURIComponent(JSON2.stringify(data.orderItemQuantity));return request}function trackView(){data.domain=getStrValue(data.domain,'');getReco()}function trackOrder(){data.domain=getStrValue(data.domain,'');data.device=getStrValue(data.device,'');data.userGroup=getStrValue(data.userGroup,'');data.orderId=getStrValue(data.orderId,'');data.orderPrice=getStrValue(data.orderPrice,'');data.orderPhoneNumber=getStrValue(data.orderPhoneNumber,'');data.orderItems=data.orderItems||[];data.orderItemsPrice=data.orderItemsPrice||[];data.orderItemsQuantity=data.orderItemsQuantity||[];if(!data.domain||!data.orderId){return}var request=getCommonRequest();request=getOrderRequest(request);var StrackRecoItemCode=[];var StrackRecoItems=[];if(data.orderItemNumber.length>0){for(var i=0;i<data.orderItemNumber.length;i++){var StrackContent=getCookie('STRACKRECO_'+data.orderItemNumber[i]);if(StrackContent!=''){StrackRecoItemCode.push(data.orderItemNumber[i]);StrackRecoItems.push(JSON2.parse(StrackContent))}}}if(getCookie('BS_MID')!=''){request+='&igmedia='+encodeURIComponent(getCookie('BS_MID'));setCookie('BS_MID','',-1,'.'+data.domain)}if(StrackRecoItems.length>0){request+='&strackreco='+encodeURIComponent(JSON2.stringify(StrackRecoItems));for(var j=0;j<StrackRecoItemCode.length;j++){setCookie('STRACKRECO_'+StrackRecoItemCode[j],'',-1,'.'+data.domain)}}request += '&version=' + version;sendRequest(request,configTrackerPause)}module.version=version;module.name=name;module.data=data;module.sha1=sha1;module.getCookie=getCookie;module.setCookie=setCookie;module.loadScript=loadScript;module.execute=execute;module.trackView=trackView;module.trackOrder=trackOrder;module.basicMethod={setStore:setStore,setDomain:setDomain,setDevice:setDevice,setUserId:setUserId,setOrderId:setOrderId,setOrderPrice:setOrderPrice,setOrderPhoneNumber:setOrderPhoneNumber,setOrderItemNumber:setOrderItemNumber,setOrderItemLink:setOrderItemLink,setOrderItemImage:setOrderItemImage,setOrderItemName:setOrderItemName,setOrderItemPrice:setOrderItemPrice,setOrderItemQuantity:setOrderItemQuantity,trackOrder:trackOrder};addEventListener(window,'beforeunload',beforeUnloadHandler,false);if(_rlq.length>0){var iterator;for(iterator=0;iterator<_rlq.length;iterator++){if(_rlq[iterator]){apply(_rlq[iterator])}}_rlq=[]}return module})(window,document);
